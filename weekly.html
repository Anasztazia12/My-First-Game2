// Load weekly progress from localStorage
let weeklyProgress = JSON.parse(localStorage.getItem("weeklyProgress")) || {
    completed: 0
};

// DOM elements
const progressText = document.getElementById("weekly-progress");
const pentagonProgress = document.getElementById("pentagon-progress");
const trophyPopup = document.getElementById("trophy-popup");

// Pentagon points (5 edges)
const pentagonEdges = [
    "100,20 180,75",   // top → right‑top
    "180,75 150,160",  // right‑top → right‑bottom
    "150,160 50,160",  // right‑bottom → left‑bottom
    "50,160 20,75",    // left‑bottom → left‑top
    "20,75 100,20"     // left‑top → top
];

// Update progress text
function updateProgressText() {
    progressText.innerText = `Weekly progress: ${weeklyProgress.completed}/5`;
}

// Draw pentagon progress lines
function updatePentagon() {
    let lines = pentagonEdges.slice(0, weeklyProgress.completed);
    pentagonProgress.setAttribute("points", lines.join(" "));
}

// Save progress
function saveProgress() {
    localStorage.setItem("weeklyProgress", JSON.stringify(weeklyProgress));
}

// Start today's challenge
function startWeeklyTask() {
    const mode = document.getElementById("weekly-mode").value;
    const diff = document.getElementById("weekly-difficulty").value;
    const op = document.getElementById("weekly-operation").value;

    // Redirect to play.html with parameters
    location.href = `play.html?mode=${mode}&op=${op}&diff=${diff}&weekly=1`;
}

// Called from play.html when a daily challenge is completed
function completeDailyTask() {
    if (weeklyProgress.completed < 5) {
        weeklyProgress.completed++;
        saveProgress();
        updateProgressText();
        updatePentagon();
    }

    if (weeklyProgress.completed === 5) {
        showTrophy();
    }
}

// Show trophy popup + confetti
function showTrophy() {
    trophyPopup.classList.add("show");
    launchConfetti();
}

// Confetti animation
function launchConfetti() {
    for (let i = 0; i < 40; i++) {
        let conf = document.createElement("div");
        conf.classList.add("confetti");

        conf.style.left = Math.random() * 100 + "vw";
        conf.style.backgroundColor = ["#ff0", "#0f0", "#0ff", "#f0f"][Math.floor(Math.random() * 4)];
        conf.style.animationDuration = (2 + Math.random() * 3) + "s";

        document.body.appendChild(conf);

        setTimeout(() => conf.remove(), 5000);
    }
}

// INITIAL LOAD
updateProgressText();
updatePentagon();

// If weeklyProgress.completed === 5 → show trophy
if (weeklyProgress.completed === 5) {
    showTrophy();
}